<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechMart E-commerce</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #131313;
            color: #e2e8f0;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #262626;
            margin: auto;
            padding: 20px;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            width: 80%;
            max-width: 400px;
            text-align: center;
            color: #e2e8f0;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: #fff;
            text-decoration: none;
            cursor: pointer;
        }
        #menuModal .modal-content {
            width: 95%;
            max-width: 600px;
            height: auto;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 30px;
        }
        #menuModal .modal-content .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
        }
        .category-dropdown-content {
            display: none;
            position: absolute;
            background-color: #000000;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 0.5rem;
            top: 100%;
            left: 0;
            margin-top: 0.5rem;
            padding: 0.5rem 0;
        }
        .category-dropdown-content button {
            color: #ffffff;
            padding: 0.75rem 1rem;
            text-decoration: none;
            display: block;
            width: 100%;
            text-align: left;
            border-radius: 0.25rem;
        }
        .category-dropdown-content button:hover {
            background-color: #262626;
        }
        .category-dropdown:hover .category-dropdown-content {
            display: block;
        }
        .sort-dropdown-content {
            display: none;
            position: absolute;
            background-color: #000000;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 0.5rem;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            padding: 0.5rem 0;
        }
        .sort-dropdown-content button {
            color: #ffffff;
            padding: 0.75rem 1rem;
            text-decoration: none;
            display: block;
            width: 100%;
            text-align: left;
            border-radius: 0.25rem;
        }
        .sort-dropdown-content button:hover {
            background-color: #262626;
        }
        .sort-dropdown:hover .sort-dropdown-content {
            display: block;
        }
        #quickViewModal .modal-content {
            max-width: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 30px;
            text-align: left;
        }
        #quickViewModal .modal-content img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        #reviewModal .modal-content {
            max-width: 500px;
            text-align: left;
        }
        .star-rating .fa-star {
            cursor: pointer;
            color: #4a5568;
        }
        .star-rating .fa-star.selected {
            color: #f6e05e;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <nav class="flex flex-col sm:flex-row items-center justify-between py-4 px-6 bg-[#262626] rounded-xl shadow-lg mb-8">
        <div class="flex items-center space-x-4 mb-4 sm:mb-0">
            <h1 class="text-3xl font-bold text-teal-400 flex items-center">
                <i class="fas fa-box mr-2"></i>TechMart
            </h1>
        </div>
        <div class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4 w-full sm:w-auto">
            <div class="relative inline-block text-left category-dropdown w-full sm:w-auto">
                <div>
                    <button type="button" class="inline-flex justify-center w-full rounded-md border border-gray-700 shadow-sm px-4 py-2 bg-[#333333] text-sm font-medium text-gray-300 hover:bg-[#444444] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-teal-500" id="categoryDropdownButton" aria-haspopup="true" aria-expanded="true">
                        Categories
                        <i class="fas fa-chevron-down ml-2 -mr-1 h-5 w-5"></i>
                    </button>
                </div>
                <div class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-black ring-1 ring-black ring-opacity-5 focus:outline-none category-dropdown-content" role="menu" aria-orientation="vertical" aria-labelledby="categoryDropdownButton">
                    <div class="py-1" role="none">
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] filter-btn" role="menuitem" data-category="All">All</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] filter-btn" role="menuitem" data-category="Electronics">Electronics</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] filter-btn" role="menuitem" data-category="Fashion">Fashion</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] filter-btn" role="menuitem" data-category="Food">Food</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] filter-btn" role="menuitem" data-category="Furniture">Furniture</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] filter-btn" role="menuitem" data-category="Sports">Sports</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] filter-btn" role="menuitem" data-category="Books">Books</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] filter-btn" role="menuitem" data-category="Home Appliances">Home Appliances</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] filter-btn" role="menuitem" data-category="Beauty & Personal Care">Beauty & Personal Care</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] filter-btn" role="menuitem" data-category="Outdoor & Camping">Outdoor & Camping</button>
                    </div>
                </div>
            </div>

            <button id="wishlistButton" class="flex items-center space-x-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg shadow-md transition duration-300 ease-in-out w-full sm:w-auto">
                <i class="fas fa-heart"></i>
                <span class="font-semibold">Wishlist (<span id="wishlistCount">0</span>)</span>
            </button>

            <button id="cartButton" class="flex items-center space-x-2 px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded-lg shadow-md transition duration-300 ease-in-out w-full sm:w-auto">
                <i class="fas fa-shopping-cart"></i>
                <span class="font-semibold">Cart (<span id="cartCount">0</span>)</span>
            </button>
            <button class="flex items-center space-x-2 px-4 py-2 bg-[#333333] hover:bg-[#444444] text-gray-300 rounded-lg shadow-md transition duration-300 ease-in-out w-full sm:w-auto">
                <i class="fas fa-sign-in-alt"></i>
                <span class="font-semibold">Login</span>
            </button>
        </div>
    </nav>

    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
        <div class="bg-[#262626] p-6 rounded-xl shadow-lg flex flex-col items-center justify-center text-center">
            <div class="text-teal-400 text-4xl mb-3">
                <i class="fas fa-box-open"></i>
            </div>
            <p class="text-3xl font-bold text-white">500+</p>
            <p class="text-gray-400 text-lg">Products</p>
        </div>
        <div class="bg-[#262626] p-6 rounded-xl shadow-lg flex flex-col items-center justify-center text-center">
            <div class="text-emerald-400 text-4xl mb-3">
                <i class="fas fa-users"></i>
            </div>
            <p class="text-3xl font-bold text-white">12K+</p>
            <p class="text-gray-400 text-lg">Customers</p>
        </div>
        <div class="bg-[#262626] p-6 rounded-xl shadow-lg flex flex-col items-center justify-center text-center">
            <div class="text-purple-400 text-4xl mb-3">
                <i class="fas fa-smile"></i>
            </div>
            <p class="text-3xl font-bold text-white">98%</p>
            <p class="text-gray-400 text-lg">Satisfaction</p>
        </div>
        <div class="bg-[#262626] p-6 rounded-xl shadow-lg flex flex-col items-center justify-center text-center">
            <div class="text-amber-300 text-4xl mb-3">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <p class="text-3xl font-bold text-white">₹2M+</p>
            <p class="text-gray-400 text-lg">Sales</p>
        </div>
    </section>

    <section>
        <div class="flex items-center justify-between mb-8">
            <div class="relative inline-block text-left sort-dropdown">
                <div>
                    <button type="button" class="inline-flex justify-center w-full rounded-md border border-gray-700 shadow-sm px-4 py-2 bg-[#333333] text-sm font-medium text-gray-300 hover:bg-[#444444] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-teal-500" id="sortDropdownButton" aria-haspopup="true" aria-expanded="true">
                        Sort By <i class="fas fa-sort ml-2 -mr-1 h-5 w-5"></i>
                    </button>
                </div>
                <div class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-black ring-1 ring-black ring-opacity-5 focus:outline-none sort-dropdown-content" role="menu" aria-orientation="vertical" aria-labelledby="sortDropdownButton">
                    <div class="py-1" role="none">
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] sort-btn" data-sort="default" role="menuitem">Default</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] sort-btn" data-sort="price-asc" role="menuitem">Price: Low to High</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] sort-btn" data-sort="price-desc" role="menuitem">Price: High to Low</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] sort-btn" data-sort="name-asc" role="menuitem">Name: A-Z</button>
                        <button class="text-white block w-full text-left px-4 py-2 text-sm hover:bg-[#262626] sort-btn" data-sort="name-desc" role="menuitem">Name: Z-A</button>
                    </div>
                </div>
            </div>
            <div class="relative w-full md:w-1/3 ml-4">
                <input type="text" id="mainSearchInput" placeholder="Search products..." class="w-full pl-10 pr-4 py-2 bg-[#262626] text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 shadow-md">
                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>
        </div>

        <div id="priceFilterSection" class="mb-8">
            <h3 class="text-xl font-bold text-white mb-4">Filter by Price</h3>
            <div class="flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4">
                <input type="number" id="minPriceInput" placeholder="Min Price" class="w-full sm:w-auto px-4 py-2 bg-[#262626] text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 shadow-md">
                <span class="text-gray-400">-</span>
                <input type="number" id="maxPriceInput" placeholder="Max Price" class="w-full sm:w-auto px-4 py-2 bg-[#262626] text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 shadow-md">
                <button id="applyPriceFilterBtn" class="w-full sm:w-auto px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out">
                    Apply Filter
                </button>
                <button id="clearPriceFilterBtn" class="w-full sm:w-auto px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out">
                    Clear Filter
                </button>
            </div>
        </div>

        <div id="ratingFilterSection" class="mb-8">
            <h3 class="text-xl font-bold text-white mb-4">Filter by Minimum Rating</h3>
            <div class="flex items-center space-x-4">
                <select id="minRatingSelect" class="w-full sm:w-auto px-4 py-2 bg-[#262626] text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 shadow-md">
                    <option value="0">Any Rating</option>
                    <option value="1">1 Star & Up</option>
                    <option value="2">2 Stars & Up</option>
                    <option value="3">3 Stars & Up</option>
                    <option value="4">4 Stars & Up</option>
                    <option value="4.5">4.5 Stars & Up</option>
                </select>
                <button id="applyRatingFilterBtn" class="w-full sm:w-auto px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out">
                    Apply Filter
                </button>
                <button id="clearRatingFilterBtn" class="w-full sm:w-auto px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out">
                    Clear Filter
                </button>
            </div>
        </div>

        <div id="searchResultsSection" class="hidden mb-12">
            <h2 class="text-3xl font-bold text-white mb-6">Search Results</h2>
            <div id="searchResultsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            </div>
        </div>

        <div id="recentlyViewedSection" class="mb-12 hidden">
            <h2 class="text-3xl font-bold text-white mb-6">Recently Viewed</h2>
            <div id="recentlyViewedGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            </div>
        </div>

        <div id="orderHistorySection" class="mb-12 hidden">
            <h2 class="text-3xl font-bold text-white mb-6">Order History</h2>
            <div id="orderHistoryGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <div class="bg-[#262626] p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-2 text-white">Order #12345</h3>
                    <p class="text-gray-400 text-sm mb-2">Date: 2024-07-20</p>
                    <p class="text-gray-400 text-sm mb-2">Total: ₹12,450.00</p>
                    <ul class="list-disc list-inside text-gray-300 text-sm">
                        <li>Wireless Bluetooth Headphones (x1)</li>
                        <li>Smart Fitness Watch (x1)</li>
                    </ul>
                </div>
                <div class="bg-[#262626] p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-2 text-white">Order #12346</h3>
                    <p class="text-gray-400 text-sm mb-2">Date: 2024-07-22</p>
                    <p class="text-gray-400 text-sm mb-2">Total: ₹2,075.00</p>
                    <ul class="list-disc list-inside text-gray-300 text-sm">
                        <li>Premium Coffee Beans (x2)</li>
                        <li>Best-selling Novel (x1)</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="allProductCategories">
        </div>
    </section>

    <div id="cartModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Your Shopping Cart</h2>
            <div id="cartItems" class="text-left mb-4 max-h-60 overflow-y-auto">
                <p class="text-gray-400" id="emptyCartMessage">Your cart is empty.</p>
            </div>
            <div class="flex justify-between items-center border-t border-[#333333] pt-4">
                <span class="text-xl font-semibold">Total:</span>
                <span class="text-xl font-bold text-teal-400" id="cartTotal">₹0.00</span>
            </div>
            <button class="w-full py-3 mt-6 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out" id="clearCartBtn">
                Clear Cart
            </button>
            <button class="w-full py-3 mt-2 bg-teal-600 hover:bg-teal-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out">
                Proceed to Checkout
            </button>
        </div>
    </div>

    <div id="wishlistModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Your Wishlist</h2>
            <div id="wishlistItems" class="text-left mb-4 max-h-60 overflow-y-auto">
                <p class="text-gray-400" id="emptyWishlistMessage">Your wishlist is empty.</p>
            </div>
            <button class="w-full py-3 mt-6 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out" id="clearWishlistBtn">
                Clear Wishlist
            </button>
            <button class="w-full py-3 mt-2 bg-teal-600 hover:bg-teal-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out" id="addToCartFromWishlistBtn">
                Add All to Cart
            </button>
        </div>
    </div>

    <div id="messageModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modalMessage" class="text-lg font-semibold"></p>
        </div>
    </div>

    <div id="quickViewModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <img id="quickViewImage" src="" alt="Product Image" class="w-full h-48 object-cover mb-4 rounded-lg">
            <h2 id="quickViewName" class="text-2xl font-bold mb-2 text-white"></h2>
            <p id="quickViewCategory" class="text-teal-400 text-sm mb-2"></p>
            <p id="quickViewDescription" class="text-gray-300 text-base mb-3"></p>
            <div class="flex items-center mb-3">
                <span class="text-amber-300"><i class="fas fa-star"></i> <span id="quickViewRating"></span></span>
                <span class="text-gray-400 ml-2">(<span id="quickViewReviews"></span> reviews)</span>
            </div>
            <div id="quickViewExistingReviews" class="w-full text-left mb-4 max-h-40 overflow-y-auto">
                <h4 class="text-lg font-semibold text-white mb-2">Customer Reviews:</h4>
                <p class="text-gray-400">No reviews yet.</p>
            </div>
            <div class="flex items-baseline mb-4">
                <span class="text-2xl font-bold text-white">₹<span id="quickViewPrice"></span></span>
                <span id="quickViewOriginalPrice" class="text-gray-500 line-through ml-2"></span>
                <span id="quickViewStock" class="ml-auto text-lime-400"></span>
            </div>
            <div class="flex items-center justify-between w-full mb-4">
                <label for="quickViewQuantity" class="text-gray-300">Qty:</label>
                <input type="number" id="quickViewQuantity" value="1" min="1" class="w-20 px-2 py-1 bg-[#333333] text-white rounded-md">
            </div>
            <div class="flex flex-col sm:flex-row gap-2 w-full">
                <button class="w-full py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out" id="quickViewAddToWishlistBtn">
                    <i class="far fa-heart mr-2"></i>Add to Wishlist
                </button>
                <button class="w-full py-3 bg-teal-600 hover:bg-teal-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out" id="quickViewAddToCartBtn">
                    <i class="fas fa-shopping-cart mr-2"></i>Add to Cart
                </button>
            </div>
            <button class="w-full py-3 mt-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out" id="quickViewAddReviewBtn">
                Add Review
            </button>
        </div>
    </div>

    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Submit Your Review</h2>
            <p class="text-gray-300 mb-4" id="reviewProductName"></p>
            <div class="mb-4">
                <label class="block text-gray-300 text-sm font-bold mb-2">Your Rating:</label>
                <div id="starRating" class="star-rating text-3xl">
                    <i class="far fa-star" data-rating="1"></i>
                    <i class="far fa-star" data-rating="2"></i>
                    <i class="far fa-star" data-rating="3"></i>
                    <i class="far fa-star" data-rating="4"></i>
                    <i class="far fa-star" data-rating="5"></i>
                </div>
                <input type="hidden" id="reviewRatingInput" value="0">
            </div>
            <div class="mb-4">
                <label for="reviewTextInput" class="block text-gray-300 text-sm font-bold mb-2">Your Review:</label>
                <textarea id="reviewTextInput" rows="4" class="shadow appearance-none border rounded w-full py-2 px-3 bg-[#333333] text-white leading-tight focus:outline-none focus:shadow-outline"></textarea>
            </div>
            <button class="w-full py-3 bg-teal-600 hover:bg-teal-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out" id="submitReviewBtn">
                Submit Review
            </button>
        </div>
    </div>

    <footer class="bg-[#262626] text-gray-300 py-8 px-6 mt-12 rounded-xl shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center md:items-start space-y-6 md:space-y-0">
            <div class="text-center md:text-left">
                <h3 class="text-xl font-bold text-white mb-3">Contact Me</h3>
                <p class="text-gray-400">SAYYAD FAYAZ BASHA</p>
                <p class="text-gray-400">Phone: 9703029115</p>
                <p class="text-gray-400">Email: fayaz1234basha@gmail.com</p>
            </div>

            <div class="text-center md:text-right">
                <h3 class="text-xl font-bold text-white mb-3">Quick Links</h3>
                <ul class="space-y-2">
                    <li><a href="#" class="hover:text-teal-400 transition duration-300">About Us</a></li>
                    <li><a href="#" class="hover:text-teal-400 transition duration-300">Privacy Policy</a></li>
                    <li><a href="#" class="hover:text-teal-400 transition duration-300">Terms of Service</a></li>
                </ul>
            </div>
        </div>

        <div class="border-t border-[#333333] mt-8 pt-6 text-center text-gray-500 text-sm">
            Developed by Sayyad Fayaz Basha
        </div>
    </footer>

    <script>
        const cartCountSpan = document.getElementById('cartCount');
        const cartButton = document.getElementById('cartButton');
        const cartModal = document.getElementById('cartModal');
        const cartItemsContainer = document.getElementById('cartItems');
        const cartTotalSpan = document.getElementById('cartTotal');
        const emptyCartMessage = document.getElementById('emptyCartMessage');
        const messageModal = document.getElementById('messageModal');
        const modalMessage = document.getElementById('modalMessage');
        
        const wishlistButton = document.getElementById('wishlistButton');
        const wishlistCountSpan = document.getElementById('wishlistCount');
        const wishlistModal = document.getElementById('wishlistModal');
        const wishlistItemsContainer = document.getElementById('wishlistItems');
        const emptyWishlistMessage = document.getElementById('emptyWishlistMessage');
        const addToCartFromWishlistBtn = document.getElementById('addToCartFromWishlistBtn');
        const clearCartBtn = document.getElementById('clearCartBtn');
        const clearWishlistBtn = document.getElementById('clearWishlistBtn');

        const categoryDropdownButton = document.getElementById('categoryDropdownButton');
        const categoryDropdownContent = document.querySelector('.category-dropdown-content');
        const filterButtons = document.querySelectorAll('.category-dropdown-content .filter-btn');
        const mainSearchInput = document.getElementById('mainSearchInput');
        const allProductCategoriesContainer = document.getElementById('allProductCategories');
        const searchResultsSection = document.getElementById('searchResultsSection');
        const searchResultsGrid = document.getElementById('searchResultsGrid');
        const sortDropdownButton = document.getElementById('sortDropdownButton');
        const sortDropdownContent = document.querySelector('.sort-dropdown-content');
        const sortButtons = document.querySelectorAll('.sort-dropdown-content .sort-btn');

        const quickViewModal = document.getElementById('quickViewModal');
        const quickViewImage = document.getElementById('quickViewImage');
        const quickViewName = document.getElementById('quickViewName');
        const quickViewCategory = document.getElementById('quickViewCategory');
        const quickViewDescription = document.getElementById('quickViewDescription');
        const quickViewRating = document.getElementById('quickViewRating');
        const quickViewReviews = document.getElementById('quickViewReviews');
        const quickViewPrice = document.getElementById('quickViewPrice');
        const quickViewOriginalPrice = document.getElementById('quickViewOriginalPrice');
        const quickViewStock = document.getElementById('quickViewStock');
        const quickViewQuantityInput = document.getElementById('quickViewQuantity');
        const quickViewAddToWishlistBtn = document.getElementById('quickViewAddToWishlistBtn');
        const quickViewAddToCartBtn = document.getElementById('quickViewAddToCartBtn');
        const quickViewAddReviewBtn = document.getElementById('quickViewAddReviewBtn');
        const quickViewExistingReviewsContainer = document.getElementById('quickViewExistingReviews');

        const reviewModal = document.getElementById('reviewModal');
        const reviewProductName = document.getElementById('reviewProductName');
        const starRatingContainer = document.getElementById('starRating');
        const reviewRatingInput = document.getElementById('reviewRatingInput');
        const reviewTextInput = document.getElementById('reviewTextInput');
        const submitReviewBtn = document.getElementById('submitReviewBtn');
        let currentProductForReview = null;

        const minPriceInput = document.getElementById('minPriceInput');
        const maxPriceInput = document.getElementById('maxPriceInput');
        const applyPriceFilterBtn = document.getElementById('applyPriceFilterBtn');
        const clearPriceFilterBtn = document.getElementById('clearPriceFilterBtn');

        const minRatingSelect = document.getElementById('minRatingSelect');
        const applyRatingFilterBtn = document.getElementById('applyRatingFilterBtn');
        const clearRatingFilterBtn = document.getElementById('clearRatingFilterBtn');

        const recentlyViewedSection = document.getElementById('recentlyViewedSection');
        const recentlyViewedGrid = document.getElementById('recentlyViewedGrid');
        const orderHistorySection = document.getElementById('orderHistorySection');

        let cart = [];
        let wishlist = [];
        let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed')) || [];
        const MAX_RECENTLY_VIEWED = 5;

        let currentSort = 'default';
        let currentMinPrice = null;
        let currentMaxPrice = null;
        let currentMinRating = 0;

        function usdToInr(usdPrice) {
            const conversionRate = 83;
            return (usdPrice * conversionRate).toFixed(2);
        }

        const products = [
            {
                id: 'p1', name: 'Wireless Bluetooth Headphones', price: 79.99, originalPrice: 89.99, stock: 15, category: 'Electronics',
                imageUrl: 'images/Wireless Bluetooth Headphones.webp', 
                description: 'High-quality wireless headphones with noise cancellation.', rating: 4.5, reviews: 127, onSale: true,
                customerReviews: [{user: 'Alice', rating: 5, comment: 'Amazing sound quality!'}, {user: 'Bob', rating: 4, comment: 'Comfortable and good battery life.'}]
            },
            {
                id: 'p2', name: 'Smart Fitness Watch', price: 199.99, stock: 8, category: 'Electronics',
                imageUrl: 'images/Smart Fitness Watch.avif', 
                description: 'Track your fitness goals with this advanced smartwatch.', rating: 4.8, reviews: 89, onSale: false,
                customerReviews: [{user: 'Charlie', rating: 5, comment: 'Very accurate and stylish.'}, {user: 'Diana', rating: 4.5, comment: 'Love the heart rate monitor.'}]
            },
            {
                id: 'p3', name: 'Premium Coffee Beans', price: 24.99, stock: 25, category: 'Food',
                imageUrl: 'images/Premium Coffee Beans.avif', 
                description: 'Organic, single-origin coffee beans from Ethiopia.', rating: 4.7, reviews: 203, onSale: false,
                customerReviews: [{user: 'Eve', rating: 5, comment: 'Rich flavor, perfect for my morning.'}]
            },
            {
                id: 'p4', name: 'Ergonomic Office Chair', price: 299.99, originalPrice: 399.99, stock: 5, category: 'Furniture',
                imageUrl: 'images/Ergonomic Office Chair.avif', 
                description: 'Comfortable office chair with lumbar support.', rating: 4.6, reviews: 156, onSale: true,
                customerReviews: [{user: 'Frank', rating: 4, comment: 'Good support for long hours.'}]
            },
            {
                id: 'p5', name: 'Vintage Leather Backpack', price: 89.99, stock: 12, category: 'Fashion',
                imageUrl: 'images/Vintage Leather Backpack.avif', 
                description: 'Handcrafted leather backpack with vintage design.', rating: 4.4, reviews: 78, onSale: false,
                customerReviews: [{user: 'Grace', rating: 4, comment: 'Stylish and spacious.'}]
            },
            {
                id: 'p6', name: 'Yoga Mat Pro', price: 49.99, stock: 20, category: 'Sports',
                imageUrl: 'images/Yoga Mat Pro.webp', 
                description: 'Professional yoga mat with excellent grip.', rating: 4.9, reviews: 245, onSale: false,
                customerReviews: [{user: 'Heidi', rating: 5, comment: 'Best grip ever, no slipping!'}]
            },
            {
                id: 'p7', name: 'Gaming Keyboard', price: 120.00, stock: 10, category: 'Electronics',
                imageUrl: 'images/Gaming Keyboard.avif', 
                description: 'Mechanical keyboard with RGB lighting for gamers.', rating: 4.7, reviews: 95, onSale: false,
                customerReviews: []
            },
            {
                id: 'p8', name: 'Smart Home Hub', price: 85.50, stock: 7, category: 'Electronics',
                imageUrl: 'images/Smart Home Hub.avif', 
                description: 'Central control for all your smart devices.', rating: 4.3, reviews: 62, onSale: false,
                customerReviews: []
            },
            {
                id: 'p9', name: 'Gourmet Chocolate Box', price: 35.00, stock: 30, category: 'Food',
                imageUrl: 'images/Gourmet Chocolate Box.avif', 
                description: 'Assorted premium chocolates for a sweet treat.', rating: 4.9, reviews: 180, onSale: false,
                customerReviews: []
            },
            {
                id: 'p10', name: 'Best-selling Novel', price: 15.99, stock: 50, category: 'Books',
                imageUrl: 'images/Best-selling Novel.avif', 
                description: 'A captivating story that will keep you hooked.', rating: 4.8, reviews: 300, onSale: false,
                customerReviews: []
            },
            {
                id: 'p11', name: 'Modern Coffee Maker', price: 75.00, stock: 18, category: 'Home Appliances',
                imageUrl: 'images/Modern Coffee Maker.avif', 
                description: 'Brew your perfect cup with ease.', rating: 4.6, reviews: 110, onSale: false,
                customerReviews: []
            },
            {
                id: 'p12', name: 'Designer Sunglasses', price: 150.00, stock: 22, category: 'Fashion',
                imageUrl: 'images/Designer Sunglasses.avif', 
                description: 'Stylish protection for your eyes.', rating: 4.7, reviews: 140, onSale: false,
                customerReviews: []
            },
            {
                id: 'p13', name: 'Electric Toothbrush', price: 65.00, stock: 35, category: 'Beauty & Personal Care',
                imageUrl: 'images/Electric Toothbrush.avif', 
                description: 'Advanced cleaning for a brighter smile.', rating: 4.5, reviews: 90, onSale: false,
                customerReviews: []
            },
            {
                id: 'p14', name: 'Camping Tent 4-Person', price: 180.00, stock: 10, category: 'Outdoor & Camping',
                imageUrl: 'images/Camping Tent 4-Person.avif', 
                description: 'Spacious and durable tent for outdoor adventures.', rating: 4.8, reviews: 115, onSale: false,
                customerReviews: []
            },
            {
                id: 'p15', name: 'Wireless Charging Pad', price: 29.99, stock: 40, category: 'Electronics',
                imageUrl: 'images/Wireless Charging Pad.avif', 
                description: 'Fast and convenient wireless charging for your devices.', rating: 4.2, reviews: 70, onSale: false,
                customerReviews: []
            },
            {
                id: 'p16', name: 'Running Shoes', price: 95.00, stock: 25, category: 'Sports',
                imageUrl: 'images/Running Shoes.avif', 
                description: 'Comfortable and supportive shoes for all types of runs.', rating: 4.6, reviews: 190, onSale: false,
                customerReviews: []
            },
            {
                id: 'p17', name: 'Blender High-Speed', price: 110.00, stock: 12, category: 'Home Appliances',
                imageUrl: 'images/Blender High-Speed.avif', 
                description: 'Powerful blender for smoothies, soups, and more.', rating: 4.7, reviews: 85, onSale: false,
                customerReviews: []
            },
            {
                id: 'p18', name: 'Skincare Serum', price: 45.00, stock: 30, category: 'Beauty & Personal Care',
                imageUrl: 'images/Skincare Serum.avif', 
                description: 'Rejuvenating serum for radiant and healthy skin.', rating: 4.9, reviews: 210, onSale: false,
                customerReviews: []
            },
            {
                id: 'p19', name: 'Portable Camping Stove', price: 60.00, stock: 15, category: 'Outdoor & Camping',
                imageUrl: 'images/Portable Camping Stove.avif', 
                description: 'Compact and efficient stove for outdoor cooking.', rating: 4.5, reviews: 75, onSale: false,
                customerReviews: []
            },
            {
                id: 'p20', name: 'Cookbook: Italian Cuisine', price: 22.50, stock: 45, category: 'Books',
                imageUrl: 'images/Cookbook Italian Cuisine.avif', 
                description: 'Authentic recipes from the heart of Italy.', rating: 4.7, reviews: 160, onSale: false,
                customerReviews: []
            },
            {
                id: 'p21', name: 'Smart LED TV 55-inch', price: 699.00, stock: 7, category: 'Electronics',
                imageUrl: 'images/Smart LED TV 55-inch.avif', 
                description: 'Immersive viewing experience with stunning 4K resolution.', rating: 4.9, reviews: 320, onSale: false,
                customerReviews: []
            },
            {
                id: 'p22', name: 'Men\'s Casual Shirt', price: 35.00, stock: 50, category: 'Fashion',
                imageUrl: 'images/Mens Casual Shirt.avif', 
                description: 'Comfortable and stylish shirt for everyday wear.', rating: 4.3, reviews: 150, onSale: false,
                customerReviews: []
            },
            {
                id: 'p23', name: 'Organic Green Tea', price: 12.00, stock: 60, category: 'Food',
                imageUrl: 'images/Organic Green Tea.avif', 
                description: 'Refreshing and healthy organic green tea bags.', rating: 4.8, reviews: 90, onSale: false,
                customerReviews: []
            },
            {
                id: 'p24', name: 'Adjustable Standing Desk', price: 450.00, stock: 8, category: 'Furniture',
                imageUrl: 'images/Adjustable Standing Desk.avif', 
                description: 'Improve your posture and productivity with this modern desk.', rating: 4.7, reviews: 70, onSale: false,
                customerReviews: []
            },
            {
                id: 'p25', name: 'Dumbbell Set (Adjustable)', price: 199.00, stock: 10, category: 'Sports',
                imageUrl: 'images/Dumbbell Set (Adjustable).avif', 
                description: 'Versatile adjustable dumbbell set for home workouts.', rating: 4.9, reviews: 130, onSale: false,
                customerReviews: []
            },
            {
                id: 'p26', name: 'Fantasy Series Book Set', price: 75.00, stock: 20, category: 'Books',
                imageUrl: 'images/Fantasy Series Book Set.avif', 
                description: 'An epic fantasy adventure in a complete box set.', rating: 4.9, reviews: 250, onSale: false,
                customerReviews: []
            },
            {
                id: 'p27', name: 'Robot Vacuum Cleaner', price: 250.00, stock: 9, category: 'Home Appliances',
                imageUrl: 'images/Robot Vacuum Cleaner.avif', 
                description: 'Intelligent cleaning for a spotless home.', rating: 4.6, reviews: 100, onSale: false,
                customerReviews: []
            },
            {
                id: 'p28', name: 'Hair Dryer Professional', price: 89.00, stock: 18, category: 'Beauty & Personal Care',
                imageUrl: 'images/Hair Dryer Professional.avif', 
                description: 'Achieve salon-quality blowouts at home.', rating: 4.5, reviews: 110, onSale: false,
                customerReviews: []
            },
            {
                id: 'p29', name: 'Hiking Backpack 60L', price: 110.00, stock: 14, category: 'Outdoor & Camping',
                imageUrl: 'images/Hiking Backpack 60L.avif', 
                description: 'Large capacity backpack for multi-day hikes.', rating: 4.8, reviews: 95, onSale: false,
                customerReviews: []
            },
            {
                id: 'p30', name: 'Noise-Cancelling Earbuds', price: 129.99, stock: 20, category: 'Electronics',
                imageUrl: 'images/Noise-Cancelling Earbuds.avif', 
                description: 'Immerse yourself in music with superior sound and noise cancellation.', rating: 4.6, reviews: 180, onSale: false,
                customerReviews: []
            },
            { id: 'p31', name: 'Portable Bluetooth Speaker', price: 49.99, stock: 30, category: 'Electronics', imageUrl: 'images/Portable Bluetooth Speaker.avif', description: 'Compact speaker with powerful sound for on-the-go music.', rating: 4.4, reviews: 100, onSale: false, customerReviews: [] },
            { id: 'p32', name: 'External SSD 1TB', price: 119.99, stock: 18, category: 'Electronics', imageUrl: 'images/External SSD 1TB.avif', description: 'High-speed external solid-state drive for data storage.', rating: 4.8, reviews: 150, onSale: false, customerReviews: [] },
            { id: 'p33', name: 'Gaming Mouse RGB', price: 59.99, stock: 25, category: 'Electronics', imageUrl: 'images/Gaming Mouse RGB.avif', description: 'Precision gaming mouse with customizable RGB lighting.', rating: 4.7, reviews: 120, onSale: false, customerReviews: [] },
            { id: 'p34', name: 'Webcam Full HD', price: 39.99, stock: 35, category: 'Electronics', imageUrl: 'images/Webcam Full HD.avif', description: 'Crystal clear video calls and streaming.', rating: 4.3, reviews: 80, onSale: false, customerReviews: [] },
            { id: 'p35', name: 'Smart Light Bulbs (2-pack)', price: 29.99, stock: 20, category: 'Electronics', imageUrl: 'images/Smart Light Bulbs (2-pack).avif', description: 'Control your home lighting from your smartphone.', rating: 4.6, reviews: 90, onSale: false, customerReviews: [] },

            { id: 'p36', name: 'Women\'s Summer Dress', price: 45.00, stock: 40, category: 'Fashion', imageUrl: 'images/Women\'s Summer Dress.avif', description: 'Lightweight and stylish dress for warm weather.', rating: 4.5, reviews: 160, onSale: false, customerReviews: [] },
            { id: 'p37', name: 'Leather Wallet', price: 29.00, stock: 30, category: 'Fashion', imageUrl: 'images/Leather Wallet.avif', description: 'Durable and elegant leather wallet with multiple card slots.', rating: 4.6, reviews: 110, onSale: false, customerReviews: [] },
            { id: 'p38', name: 'Unisex Hoodie', price: 55.00, stock: 28, category: 'Fashion', imageUrl: 'images/Unisex Hoodie.avif', description: 'Comfortable and versatile hoodie for all seasons.', rating: 4.7, reviews: 180, onSale: false, customerReviews: [] },
            { id: 'p39', name: 'Sports Socks (3-pair)', price: 15.00, stock: 60, category: 'Fashion', imageUrl: 'images/Sports Socks (3-pair).avif', description: 'Breathable and cushioned socks for athletic activities.', rating: 4.2, reviews: 90, onSale: false, customerReviews: [] },
            { id: 'p40', name: 'Classic Denim Jeans', price: 65.00, stock: 35, category: 'Fashion', imageUrl: 'images/Classic Denim Jeans.avif', description: 'Timeless denim jeans for a casual look.', rating: 4.4, reviews: 140, onSale: false, customerReviews: [] },

            { id: 'p41', name: 'Assorted Tea Collection', price: 18.00, stock: 40, category: 'Food', imageUrl: 'images/Assorted Tea Collection.avif', description: 'Variety of premium tea bags for every mood.', rating: 4.6, reviews: 100, onSale: false, customerReviews: [] },
            { id: 'p42', name: 'Artisan Bread Mix', price: 8.50, stock: 50, category: 'Food', imageUrl: 'images/Artisan Bread Mix.avif', description: 'Easy-to-use mix for baking delicious homemade bread.', rating: 4.5, reviews: 70, onSale: false, customerReviews: [] },
            { id: 'p43', name: 'Spicy Snack Variety Pack', price: 14.00, stock: 35, category: 'Food', imageUrl: 'images/Spicy Snack Variety Pack.avif', description: 'Assortment of fiery snacks for the adventurous palate.', rating: 4.3, reviews: 60, onSale: false, customerReviews: [] },
            { id: 'p44', name: 'Organic Honey 500g', price: 19.50, stock: 25, category: 'Food', imageUrl: 'images/Organic Honey 500g.avif', description: 'Pure and natural organic honey, perfect for sweetening.', rating: 4.9, reviews: 110, onSale: false, customerReviews: [] },
            { id: 'p45', name: 'Exotic Spice Set', price: 28.00, stock: 20, category: 'Food', imageUrl: 'images/Exotic Spice Set.avif', description: 'Collection of rare and aromatic spices for culinary exploration.', rating: 4.7, reviews: 80, onSale: false, customerReviews: [] },

            { id: 'p46', name: 'Modern Bookshelf', price: 180.00, stock: 10, category: 'Furniture', imageUrl: 'images/Modern Bookshelf.avif', description: 'Sleek and spacious bookshelf for your living room or office.', rating: 4.5, reviews: 90, onSale: false, customerReviews: [] },
            { id: 'p47', name: 'Accent Coffee Table', price: 120.00, stock: 15, category: 'Furniture', imageUrl: 'images/Accent Coffee Table.avif', description: 'Stylish coffee table to complement any decor.', rating: 4.6, reviews: 75, onSale: false, customerReviews: [] },
            { id: 'p48', name: 'Velvet Armchair', price: 350.00, stock: 7, category: 'Furniture', imageUrl: 'images/Velvet Armchair.avif', description: 'Luxurious and comfortable armchair for ultimate relaxation.', rating: 4.8, reviews: 60, onSale: false, customerReviews: [] },
            { id: 'p49', name: 'Dining Table Set (4-seater)', price: 550.00, stock: 5, category: 'Furniture', imageUrl: 'images/Dining Table Set (4-seater).avif', description: 'Elegant dining set perfect for family meals.', rating: 4.7, reviews: 45, onSale: false, customerReviews: [] },
            { id: 'p50', name: 'Bedside Lamp with USB', price: 40.00, stock: 22, category: 'Furniture', imageUrl: 'images/Bedside Lamp with USB.avif', description: 'Modern lamp with convenient USB charging port.', rating: 4.4, reviews: 85, onSale: false, customerReviews: [] },

            { id: 'p51', name: 'Fitness Tracker Band', price: 55.00, stock: 30, category: 'Sports', imageUrl: 'images/Fitness Tracker Band.avif', description: 'Monitor your activity and sleep with this sleek fitness band.', rating: 4.5, reviews: 110, onSale: false, customerReviews: [] },
            { id: 'p52', name: 'Resistance Bands Set', price: 25.00, stock: 40, category: 'Sports', imageUrl: 'images/Resistance Bands Set.avif', description: 'Versatile bands for strength training and stretching.', rating: 4.7, reviews: 95, onSale: false, customerReviews: [] },
            { id: 'p53', name: 'Basketball Official Size', price: 30.00, stock: 20, category: 'Sports', imageUrl: 'images/Basketball Official Size.avif', description: 'Durable basketball for indoor and outdoor play.', rating: 4.6, reviews: 80, onSale: false, customerReviews: [] },
            { id: 'p54', name: 'Jump Rope with Counter', price: 18.00, stock: 55, category: 'Sports', imageUrl: 'images/Jump Rope with Counter.avif', description: 'Adjustable jump rope with built-in digital counter.', rating: 4.4, reviews: 70, onSale: false, customerReviews: [] },
            { id: 'p55', name: 'Cycling Helmet', price: 70.00, stock: 15, category: 'Sports', imageUrl: 'images/Cycling Helmet.avif', description: 'Lightweight and protective helmet for cyclists.', rating: 4.8, reviews: 65, onSale: false, customerReviews: [] },

            { id: 'p56', name: 'Self-Help Bestseller', price: 19.99, stock: 40, category: 'Books', imageUrl: 'images/Self-Help Bestseller.avif', description: 'Transform your life with insights from this popular guide.', rating: 4.6, reviews: 200, onSale: false, customerReviews: [] },
            { id: 'p57', name: 'Science Fiction Anthology', price: 25.00, stock: 30, category: 'Books', imageUrl: 'images/Science Fiction Anthology.avif', description: 'Collection of thrilling short stories from top sci-fi authors.', rating: 4.7, reviews: 150, onSale: false, customerReviews: [] },
            { id: 'p58', name: 'Children\'s Picture Book', price: 9.50, stock: 60, category: 'Books', imageUrl: 'images/Children\'s Picture Book.avif', description: 'Engaging and colorful book for young readers.', rating: 4.9, reviews: 180, onSale: false, customerReviews: [] },
            { id: 'p59', name: 'History of Ancient Civilizations', price: 35.00, stock: 25, category: 'Books', imageUrl: 'images/History of Ancient Civilizations.avif', description: 'Comprehensive guide to the world\'s earliest societies.', rating: 4.8, reviews: 100, onSale: false, customerReviews: [] },
            { id: 'p60', name: 'Coding for Beginners', price: 29.00, stock: 30, category: 'Books', imageUrl: 'images/Coding for Beginners.avif', description: 'An easy-to-follow introduction to programming concepts.', rating: 4.5, reviews: 120, onSale: false, customerReviews: [] },

            { id: 'p61', name: 'Air Fryer Digital', price: 99.00, stock: 15, category: 'Home Appliances', imageUrl: 'images/Air Fryer Digital.avif', description: 'Cook healthier meals with less oil and more flavor.', rating: 4.7, reviews: 130, onSale: false, customerReviews: [] },
            { id: 'p62', name: 'Handheld Vacuum Cleaner', price: 40.00, stock: 25, category: 'Home Appliances', imageUrl: 'images/Handheld Vacuum Cleaner.avif', description: 'Compact and powerful for quick clean-ups.', rating: 4.4, reviews: 90, onSale: false, customerReviews: [] },
            { id: 'p63', name: 'Smart Toaster Oven', price: 70.00, stock: 18, category: 'Home Appliances', imageUrl: 'images/Smart Toaster Oven.avif', description: 'Multi-functional oven with smart cooking presets.', rating: 4.6, reviews: 100, onSale: false, customerReviews: [] },
            { id: 'p64', name: 'Electric Kettle', price: 30.00, stock: 30, category: 'Home Appliances', imageUrl: 'images/Electric Kettle.avif', description: 'Boil water quickly and safely for your hot beverages.', rating: 4.5, reviews: 70, onSale: false, customerReviews: [] },
            { id: 'p65', name: 'Garment Steamer', price: 50.00, stock: 20, category: 'Home Appliances', imageUrl: 'images/Garment Steamer.avif', description: 'Effortlessly remove wrinkles from your clothes.', rating: 4.3, reviews: 60, onSale: false, customerReviews: [] },

            { id: 'p66', name: 'Facial Cleansing Brush', price: 39.99, stock: 28, category: 'Beauty & Personal Care', imageUrl: 'images/Facial Cleansing Brush.avif', description: 'Deep cleanse your skin for a refreshed complexion.', rating: 4.6, reviews: 100, onSale: false, customerReviews: [] },
            { id: 'p67', name: 'Premium Shaving Kit', price: 49.00, stock: 20, category: 'Beauty & Personal Care', imageUrl: 'images/Premium Shaving Kit.avif', description: 'Complete set for a smooth and comfortable shave.', rating: 4.7, reviews: 80, onSale: false, customerReviews: [] },
            { id: 'p68', name: 'Anti-Aging Moisturizer', price: 60.00, stock: 25, category: 'Beauty & Personal Care', imageUrl: 'images/Anti-Aging Moisturizer.avif', description: 'Reduce fine lines and wrinkles for youthful-looking skin.', rating: 4.8, reviews: 150, onSale: false, customerReviews: [] },
            { id: 'p69', name: 'Nail Care Set', price: 22.00, stock: 35, category: 'Beauty & Personal Care', imageUrl: 'images/Nail Care Set.avif', description: 'Essential tools for a perfect manicure and pedicure.', rating: 4.4, reviews: 60, onSale: false, customerReviews: [] },
            { id: 'p70', name: 'Aromatherapy Diffuser', price: 35.00, stock: 20, category: 'Beauty & Personal Care', imageUrl: 'images/Aromatherapy Diffuser.avif', description: 'Create a calming ambiance with your favorite essential oils.', rating: 4.5, reviews: 90, onSale: false, customerReviews: [] },

            { id: 'p71', name: 'Portable Camping Chair', price: 40.00, stock: 25, category: 'Outdoor & Camping', imageUrl: 'images/Portable Camping Chair.avif', description: 'Lightweight and foldable chair for outdoor relaxation.', rating: 4.6, reviews: 85, onSale: false, customerReviews: [] },
            { id: 'p72', name: 'Sleeping Bag 3-Season', price: 80.00, stock: 15, category: 'Outdoor & Camping', imageUrl: 'images/Sleeping Bag 3-Season.avif', description: 'Comfortable and warm sleeping bag for various weather conditions.', rating: 4.7, reviews: 100, onSale: false, customerReviews: [] },
            { id: 'p73', name: 'Headlamp LED Rechargeable', price: 25.00, stock: 30, category: 'Outdoor & Camping', imageUrl: 'images/Headlamp LED Rechargeable.avif', description: 'Bright and long-lasting headlamp for night activities.', rating: 4.5, reviews: 70, onSale: false, customerReviews: [] },
            { id: 'p74', name: 'Camping Cookware Set', price: 55.00, stock: 18, category: 'Outdoor & Camping', imageUrl: 'images/Camping Cookware Set.avif', description: 'Compact and durable set for cooking meals outdoors.', rating: 4.8, reviews: 90, onSale: false, customerReviews: [] },
            { id: 'p75', name: 'Water Filter Bottle', price: 32.00, stock: 22, category: 'Outdoor & Camping', imageUrl: 'images/Water Filter Bottle.avif', description: 'Stay hydrated with clean, filtered water on the go.', rating: 4.7, reviews: 75, onSale: false, customerReviews: [] },
            { id: 'p76', name: 'Smart Thermostat', price: 120.00, stock: 10, category: 'Home Appliances', imageUrl: 'images/Smart Thermostat.avif', description: 'Control your home temperature remotely and save energy.', rating: 4.5, reviews: 80, onSale: false, customerReviews: [] },
            { id: 'p77', name: 'Pressure Cooker Electric', price: 90.00, stock: 15, category: 'Home Appliances', imageUrl: 'images/Pressure Cooker Electric.avif', description: 'Cook meals faster and more efficiently with this electric pressure cooker.', rating: 4.6, reviews: 110, onSale: false, customerReviews: [] },
            { id: 'p78', name: 'Digital Photo Frame', price: 65.00, stock: 20, category: 'Electronics', imageUrl: 'images/Digital Photo Frame.avif', description: 'Display your favorite memories with a high-resolution digital photo frame.', rating: 4.2, reviews: 50, onSale: false, customerReviews: [] },
            { id: 'p79', name: 'Portable Projector', price: 250.00, stock: 8, category: 'Electronics', imageUrl: 'images/Portable Projector.avif', description: 'Enjoy movies and presentations anywhere with this compact projector.', rating: 4.7, reviews: 70, onSale: false, customerReviews: [] },
            { id: 'p80', name: 'Noise Machine for Sleep', price: 35.00, stock: 25, category: 'Home Appliances', imageUrl: 'images/Noise Machine for Sleep.avif', description: 'Create a peaceful sleep environment with soothing sounds.', rating: 4.4, reviews: 90, onSale: false, customerReviews: [] },
            { id: 'p81', name: 'Travel Mug Insulated', price: 20.00, stock: 50, category: 'Food', imageUrl: 'images/Travel Mug Insulated.avif', description: 'Keep your beverages hot or cold for hours on the go.', rating: 4.8, reviews: 130, onSale: false, customerReviews: [] },
            { id: 'p82', name: 'Gourmet Pasta Assortment', price: 28.00, stock: 30, category: 'Food', imageUrl: 'images/Gourmet Pasta Assortment.avif', description: 'A selection of artisanal pasta shapes for delicious meals.', rating: 4.5, reviews: 60, onSale: false, customerReviews: [] },
            { id: 'p83', name: 'Indoor Herb Garden Kit', price: 40.00, stock: 18, category: 'Home Appliances', imageUrl: 'images/Indoor Herb Garden Kit.avif', description: 'Grow fresh herbs indoors all year round with this easy-to-use kit.', rating: 4.7, reviews: 75, onSale: false, customerReviews: [] },
            { id: 'p84', name: 'Smart Scale Body Composition', price: 75.00, stock: 12, category: 'Sports', imageUrl: 'images/Smart Scale Body Composition.avif', description: 'Track your weight, body fat, muscle mass, and more with this smart scale.', rating: 4.6, reviews: 95, onSale: false, customerReviews: [] },
            { id: 'p85', name: 'Resistance Band Set with Door Anchor', price: 30.00, stock: 35, category: 'Sports', imageUrl: 'images/Resistance Band Set with Door Anchor.avif', description: 'Full body workout at home or on the go with this versatile band set.', rating: 4.7, reviews: 100, onSale: false, customerReviews: [] },
            { id: 'p86', name: 'Waterproof Bluetooth Speaker', price: 60.00, stock: 20, category: 'Electronics', imageUrl: 'images/Waterproof Bluetooth Speaker.avif', description: 'Enjoy music by the pool or in the shower with this durable speaker.', rating: 4.5, reviews: 85, onSale: false, customerReviews: [] },
            { id: 'p87', name: 'Portable Power Bank 20000mAh', price: 45.00, stock: 25, category: 'Electronics', imageUrl: 'images/Portable Power Bank 20000mAh.avif', description: 'Keep your devices charged on the go with this high-capacity power bank.', rating: 4.8, reviews: 120, onSale: false, customerReviews: [] },
            { id: 'p88', name: 'Smart Doorbell Camera', price: 150.00, stock: 7, category: 'Home Appliances', imageUrl: 'images/Smart Doorbell Camera.avif', description: 'Monitor your front door from anywhere with two-way audio and HD video.', rating: 4.9, reviews: 65, onSale: false, customerReviews: [] },
            { id: 'p89', name: 'Air Purifier with HEPA Filter', price: 180.00, stock: 10, category: 'Home Appliances', imageUrl: 'images/Air Purifier with HEPA Filter.avif', description: 'Improve indoor air quality by removing allergens, dust, and odors.', rating: 4.7, reviews: 90, onSale: false, customerReviews: [] },
            { id: 'p90', name: 'Robot Mop', price: 220.00, stock: 6, category: 'Home Appliances', imageUrl: 'images/Robot Mop.avif', description: 'Automate your floor cleaning with this intelligent robot mop.', rating: 4.6, reviews: 55, onSale: false, customerReviews: [] },
            { id: 'p91', name: 'Digital Kitchen Scale', price: 25.00, stock: 40, category: 'Home Appliances', imageUrl: 'images/Digital Kitchen Scale.avif', description: 'Precise measurements for cooking and baking with a digital display.', rating: 4.4, reviews: 70, onSale: false, customerReviews: [] },
            { id: 'p92', name: 'Espresso Machine Compact', price: 199.00, stock: 10, category: 'Home Appliances', imageUrl: 'images/Espresso Machine Compact.avif', description: 'Brew rich, authentic espresso at home with this compact machine.', rating: 4.8, reviews: 80, onSale: false, customerReviews: [] },
            { id: 'p93', name: 'Handheld Garment Steamer', price: 40.00, stock: 30, category: 'Home Appliances', imageUrl: 'images/Handheld Garment Steamer.avif', description: 'Quickly remove wrinkles from clothes with this portable steamer.', rating: 4.3, reviews: 60, onSale: false, customerReviews: [] },
            { id: 'p94', name: 'Smart Plug (4-pack)', price: 35.00, stock: 20, category: 'Electronics', imageUrl: 'images/Smart Plug (4-pack).avif', description: 'Control your appliances from anywhere and set schedules.', rating: 4.6, reviews: 110, onSale: false, customerReviews: [] },
            { id: 'p95', name: 'VR Headset Entry-Level', price: 299.00, stock: 5, category: 'Electronics', imageUrl: 'images/VR Headset Entry-Level.avif', description: 'Experience immersive virtual reality with this easy-to-use headset.', rating: 4.2, reviews: 40, onSale: false, customerReviews: [] },
            { id: 'p96', name: 'Portable Photo Printer', price: 99.00, stock: 15, category: 'Electronics', imageUrl: 'images/Portable Photo Printer.avif', description: 'Print instant photos from your smartphone wherever you go.', rating: 4.5, reviews: 70, onSale: false, customerReviews: [] },
            { id: 'p97', name: 'Action Camera 4K', price: 180.00, stock: 10, category: 'Electronics', imageUrl: 'images/Action Camera 4K.avif', description: 'Capture your adventures in stunning 4K resolution.', rating: 4.7, reviews: 90, onSale: false, customerReviews: [] },
            { id: 'p98', name: 'Car Dash Cam', price: 70.00, stock: 20, category: 'Electronics', imageUrl: 'images/Car Dash Cam.avif', description: 'Record your drives for safety and peace of mind.', rating: 4.3, reviews: 60, onSale: false, customerReviews: [] },
            { id: 'p99', name: 'Portable SSD 2TB', price: 219.99, stock: 10, category: 'Electronics', imageUrl: 'images/Portable SSD 2TB.avif', description: 'Massive storage in a compact design for all your files.', rating: 4.9, reviews: 100, onSale: false, customerReviews: [] },
            { id: 'p100', name: 'Gaming Headset with Mic', price: 75.00, stock: 18, category: 'Electronics', imageUrl: 'images/Gaming Headset with Mic.avif', description: 'Immersive audio and clear communication for gaming.', rating: 4.6, reviews: 80, onSale: false, customerReviews: [] }
        ];

        function showMessage(message) {
            modalMessage.textContent = message;
            messageModal.style.display = 'flex';
        }

        function closeModals() {
            cartModal.style.display = 'none';
            wishlistModal.style.display = 'none';
            messageModal.style.display = 'none';
            quickViewModal.style.display = 'none';
            reviewModal.style.display = 'none';
        }

        document.querySelectorAll('.close-button').forEach(button => {
            button.addEventListener('click', closeModals);
        });

        window.addEventListener('click', (event) => {
            if (event.target == cartModal) {
                cartModal.style.display = 'none';
            }
            if (event.target == wishlistModal) {
                wishlistModal.style.display = 'none';
            }
            if (event.target == messageModal) {
                messageModal.style.display = 'none';
            }
            if (event.target == quickViewModal) {
                quickViewModal.style.display = 'none';
            }
            if (event.target == reviewModal) {
                reviewModal.style.display = 'none';
            }
            if (!event.target.closest('.category-dropdown')) {
                categoryDropdownContent.style.display = 'none';
            }
            if (!event.target.closest('.sort-dropdown')) {
                sortDropdownContent.style.display = 'none';
            }
        });

        function updateCartDisplay() {
            cartCountSpan.textContent = cart.reduce((total, item) => total + item.quantity, 0);
            cartItemsContainer.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                emptyCartMessage.style.display = 'block';
                clearCartBtn.disabled = true;
            } else {
                emptyCartMessage.style.display = 'none';
                clearCartBtn.disabled = false;
                cart.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.classList.add('flex', 'justify-between', 'items-center', 'py-2', 'border-b', 'border-[#333333]');
                    itemDiv.innerHTML = `
                        <p>${item.name}</p>
                        <div class="flex items-center">
                            <button class="px-2 py-1 bg-gray-700 text-white rounded-md mr-1 update-cart-qty" data-index="${index}" data-action="decrease">-</button>
                            <input type="number" value="${item.quantity}" min="1" max="${products.find(p => p.id === item.id).stock + item.quantity}" class="w-16 text-center bg-[#333333] text-white rounded-md quantity-in-cart-input" data-index="${index}">
                            <button class="px-2 py-1 bg-gray-700 text-white rounded-md ml-1 update-cart-qty" data-index="${index}" data-action="increase">+</button>
                        </div>
                        <p>₹${usdToInr(item.price * item.quantity)}</p>
                        <button class="text-rose-400 hover:text-rose-600 ml-4 remove-from-cart-btn" data-index="${index}"><i class="fas fa-trash-alt"></i></button>
                    `;
                    cartItemsContainer.appendChild(itemDiv);
                    total += item.price * item.quantity;
                });
            }
            cartTotalSpan.textContent = `₹${usdToInr(total)}`;

            document.querySelectorAll('.remove-from-cart-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const indexToRemove = parseInt(event.target.closest('button').dataset.index);
                    const removedItem = cart[indexToRemove];

                    const productInProductsArray = products.find(p => p.id === removedItem.id);

                    if (productInProductsArray) {
                        productInProductsArray.stock += removedItem.quantity;
                        const productCardElement = document.querySelector(`.product-card[data-id="${productInProductsArray.id}"]`);
                        if (productCardElement) {
                            let currentStockElement = productCardElement.querySelector('.product-stock');
                            let quantityInput = productCardElement.querySelector('.quantity-input');
                            let addToCartBtn = productCardElement.querySelector('.add-to-cart-btn');

                            currentStockElement.textContent = `${productInProductsArray.stock} in stock`;
                            currentStockElement.classList.remove('text-rose-400');
                            currentStockElement.classList.add('text-lime-400');
                            quantityInput.max = productInProductsArray.stock;
                            quantityInput.disabled = false;
                            addToCartBtn.disabled = false;
                            addToCartBtn.textContent = 'Add to Cart';
                        }
                    }

                    cart.splice(indexToRemove, 1);
                    updateCartDisplay();
                });
            });

            document.querySelectorAll('.update-cart-qty').forEach(button => {
                button.addEventListener('click', (event) => {
                    const index = parseInt(event.target.closest('button').dataset.index);
                    const action = event.target.closest('button').dataset.action;
                    const item = cart[index];
                    const product = products.find(p => p.id === item.id);

                    if (action === 'increase') {
                        if (product.stock > 0) {
                            item.quantity++;
                            product.stock--;
                        } else {
                            showMessage(`No more stock available for ${product.name}.`);
                        }
                    } else if (action === 'decrease') {
                        if (item.quantity > 1) {
                            item.quantity--;
                            product.stock++;
                        } else {
                            showMessage(`Quantity cannot be less than 1. Remove item to clear.`);
                        }
                    }
                    updateCartDisplay();
                    renderAllCategorizedProducts();
                });
            });

            document.querySelectorAll('.quantity-in-cart-input').forEach(input => {
                input.addEventListener('change', (event) => {
                    const index = parseInt(event.target.dataset.index);
                    const newQuantity = parseInt(event.target.value);
                    const item = cart[index];
                    const product = products.find(p => p.id === item.id);
                    
                    if (isNaN(newQuantity) || newQuantity < 1) {
                        event.target.value = item.quantity;
                        showMessage("Please enter a valid quantity (minimum 1).");
                        return;
                    }

                    const maxAllowed = product.stock + item.quantity;
                    if (newQuantity > maxAllowed) {
                        event.target.value = item.quantity;
                        showMessage(`Not enough stock for ${product.name}. Max available is ${maxAllowed}.`);
                        return;
                    }

                    const quantityDifference = newQuantity - item.quantity;
                    product.stock -= quantityDifference;
                    item.quantity = newQuantity;

                    updateCartDisplay();
                    renderAllCategorizedProducts();
                });
            });
        }

        function updateWishlistDisplay() {
            wishlistCountSpan.textContent = wishlist.length;
            wishlistItemsContainer.innerHTML = '';

            if (wishlist.length === 0) {
                emptyWishlistMessage.style.display = 'block';
                addToCartFromWishlistBtn.disabled = true;
                clearWishlistBtn.disabled = true;
            } else {
                emptyWishlistMessage.style.display = 'none';
                addToCartFromWishlistBtn.disabled = false;
                clearWishlistBtn.disabled = false;
                wishlist.forEach((productId, index) => {
                    const product = products.find(p => p.id === productId);
                    if (product) {
                        const itemDiv = document.createElement('div');
                        itemDiv.classList.add('flex', 'justify-between', 'items-center', 'py-2', 'border-b', 'border-[#333333]');
                        itemDiv.innerHTML = `
                            <p>${product.name}</p>
                            <p>₹${usdToInr(product.price)}</p>
                            <button class="text-rose-400 hover:text-rose-600 ml-4 remove-from-wishlist-btn" data-id="${productId}"><i class="fas fa-trash-alt"></i></button>
                        `;
                        wishlistItemsContainer.appendChild(itemDiv);
                    }
                });
            }

            document.querySelectorAll('.remove-from-wishlist-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const productIdToRemove = event.target.closest('button').dataset.id;
                    wishlist = wishlist.filter(id => id !== productIdToRemove);
                    updateWishlistDisplay();

                    const productCardElement = document.querySelector(`.product-card[data-id="${productIdToRemove}"]`);
                    if (productCardElement) {
                        const heartIcon = productCardElement.querySelector('.wishlist-toggle-btn i');
                        heartIcon.classList.remove('fas', 'text-rose-500');
                        heartIcon.classList.add('far', 'text-gray-400');
                        const addToWishlistBtn = productCardElement.querySelector('.add-to-wishlist-btn');
                        if (addToWishlistBtn) {
                            addToWishlistBtn.innerHTML = `<i class="far fa-heart mr-2"></i>Add to Wishlist`;
                        }
                    }
                });
            });
        }

        function toggleWishlist(productId, buttonElement) {
            const indexInWishlist = wishlist.indexOf(productId);
            const productCardElement = document.querySelector(`.product-card[data-id="${productId}"]`);

            if (indexInWishlist > -1) {
                wishlist.splice(indexInWishlist, 1);
                showMessage(`Removed from wishlist!`);
                if (productCardElement) {
                    productCardElement.querySelectorAll('.wishlist-toggle-btn i').forEach(icon => {
                        icon.classList.remove('fas', 'text-rose-500');
                        icon.classList.add('far', 'text-gray-400');
                    });
                    productCardElement.querySelectorAll('.add-to-wishlist-btn').forEach(btn => {
                        btn.innerHTML = `<i class="far fa-heart mr-2"></i>Add to Wishlist`;
                    });
                }
            } else {
                wishlist.push(productId);
                showMessage(`Added to wishlist!`);
                if (productCardElement) {
                    productCardElement.querySelectorAll('.wishlist-toggle-btn i').forEach(icon => {
                        icon.classList.remove('far', 'text-gray-400');
                        icon.classList.add('fas', 'text-rose-500');
                    });
                    productCardElement.querySelectorAll('.add-to-wishlist-btn').forEach(btn => {
                        btn.innerHTML = `<i class="fas fa-heart mr-2"></i>Remove from Wishlist`;
                    });
                }
            }
            updateWishlistDisplay();
        }

        function sortProducts(productsArray, sortType) {
            switch (sortType) {
                case 'price-asc':
                    return [...productsArray].sort((a, b) => a.price - b.price);
                case 'price-desc':
                    return [...productsArray].sort((a, b) => b.price - a.price);
                case 'name-asc':
                    return [...productsArray].sort((a, b) => a.name.localeCompare(b.name));
                case 'name-desc':
                    return [...productsArray].sort((a, b) => b.name.localeCompare(a.name));
                case 'default':
                default:
                    return [...productsArray].sort((a, b) => a.id.localeCompare(b.id));
            }
        }

        function filterProductsByPrice(productsArray) {
            const minPrice = parseFloat(minPriceInput.value);
            const maxPrice = parseFloat(maxPriceInput.value);

            return productsArray.filter(product => {
                const productPrice = parseFloat(usdToInr(product.price));
                const meetsMin = isNaN(minPrice) || productPrice >= minPrice;
                const meetsMax = isNaN(maxPrice) || productPrice <= maxPrice;
                return meetsMin && meetsMax;
            });
        }

        function filterProductsByRating(productsArray) {
            const minRating = parseFloat(minRatingSelect.value);
            return productsArray.filter(product => product.rating >= minRating);
        }

        function addRecentlyViewed(productId) {
            recentlyViewed = recentlyViewed.filter(id => id !== productId);
            recentlyViewed.unshift(productId);
            if (recentlyViewed.length > MAX_RECENTLY_VIEWED) {
                recentlyViewed.pop();
            }
            localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
            renderRecentlyViewed();
        }

        function renderRecentlyViewed() {
            if (recentlyViewed.length > 0) {
                recentlyViewedSection.classList.remove('hidden');
                recentlyViewedGrid.innerHTML = '';
                const recentlyViewedProducts = recentlyViewed.map(id => products.find(p => p.id === id)).filter(Boolean);
                renderProductsIntoGrid(recentlyViewedProducts, recentlyViewedGrid);
            } else {
                recentlyViewedSection.classList.add('hidden');
            }
        }

        function renderProductsIntoGrid(productsToRender, targetGridElement) {
            targetGridElement.innerHTML = '';
            if (productsToRender.length === 0) {
                targetGridElement.innerHTML = '<p class="text-gray-400 col-span-full text-center">No products found in this category.</p>';
                return;
            }

            let filteredProducts = filterProductsByPrice(productsToRender);
            filteredProducts = filterProductsByRating(filteredProducts);
            let filteredAndSortedProducts = sortProducts(filteredProducts, currentSort);

            if (filteredAndSortedProducts.length === 0) {
                targetGridElement.innerHTML = '<p class="text-gray-400 col-span-full text-center">No products match your filter criteria in this category.</p>';
                return;
            }

            filteredAndSortedProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('bg-[#262626]', 'rounded-xl', 'shadow-lg', 'overflow-hidden', 'relative', 'product-card');
                productCard.dataset.id = product.id;
                productCard.dataset.name = product.name;
                productCard.dataset.price = product.price;
                productCard.dataset.stock = product.stock;
                productCard.dataset.category = product.category;

                const saleBadge = product.onSale ? `<span class="absolute top-3 left-3 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full">Sale</span>` : '';
                const originalPriceHtml = product.onSale ? `<span class="text-gray-500 line-through ml-2">₹${usdToInr(product.originalPrice)}</span>` : '';
                const stockColorClass = product.stock === 0 ? 'text-rose-400' : 'text-lime-400';
                const addToCartDisabled = product.stock === 0 ? 'disabled' : '';
                const addToCartText = product.stock === 0 ? 'Out of Stock' : 'Add to Cart';
                const quantityInputDisabled = product.stock === 0 ? 'disabled' : '';
                const quantityInputValue = product.stock === 0 ? '0' : '1';
                
                const isProductInWishlist = wishlist.includes(product.id);
                const heartIconClass = isProductInWishlist ? 'fas text-rose-500' : 'far text-gray-400';
                const addToWishlistBtnText = isProductInWishlist ? 'Remove from Wishlist' : 'Add to Wishlist';


                productCard.innerHTML = `
                    ${saleBadge}
                    <button class="absolute top-3 right-3 text-xl wishlist-toggle-btn" data-id="${product.id}"><i class="${heartIconClass}"></i></button>
                    <img src="${product.imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/400x250/333333/FFFFFF?text=Image+Error';" alt="${product.name}" class="w-full h-48 object-cover">
                    <div class="p-6">
                        <h3 class="text-xl font-semibold mb-2 text-white">${product.name}</h3>
                        <p class="text-teal-400 text-sm mb-2 product-category">${product.category}</p>
                        <p class="text-gray-300 text-sm mb-3">${product.description}</p>
                        <div class="flex items-center mb-3">
                            <span class="text-amber-300"><i class="fas fa-star"></i> ${product.rating}</span>
                            <span class="text-gray-400 ml-2">(${product.reviews})</span>
                        </div>
                        <div class="flex items-baseline mb-4">
                            <span class="text-2xl font-bold text-white">₹${usdToInr(product.price)}</span>
                            ${originalPriceHtml}
                            <span class="ml-auto ${stockColorClass} product-stock">${product.stock} in stock</span>
                        </div>
                        <div class="flex items-center justify-between mb-4">
                            <label for="quantity-${product.id}" class="text-gray-300">Qty:</label>
                            <input type="number" id="quantity-${product.id}" value="${quantityInputValue}" min="1" max="${product.stock}" class="w-20 px-2 py-1 bg-[#333333] text-white rounded-md quantity-input" ${quantityInputDisabled}>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2 mt-4">
                            <button class="w-full py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out add-to-wishlist-btn" data-id="${product.id}">
                                <i class="${isProductInWishlist ? 'fas' : 'far'} fa-heart mr-2"></i>${addToWishlistBtnText}
                            </button>
                            <button class="w-full py-3 bg-teal-600 hover:bg-teal-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out add-to-cart-btn" ${addToCartDisabled}>
                                <i class="fas fa-shopping-cart mr-2"></i>${addToCartText}
                            </button>
                        </div>
                        <button class="w-full py-3 mt-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out quick-view-btn" data-id="${product.id}">
                            Quick View
                        </button>
                    </div>
                `;
                targetGridElement.appendChild(productCard);
            });

            attachProductCardEventListeners();
        }

        function renderAllCategorizedProducts() {
            allProductCategoriesContainer.innerHTML = '';
            searchResultsSection.classList.add('hidden');

            const uniqueCategories = [...new Set(products.map(p => p.category))].sort();

            uniqueCategories.forEach(category => {
                const categorySection = document.createElement('section');
                categorySection.id = `category-${category.replace(/\s+/g, '-').toLowerCase()}`;
                categorySection.classList.add('mb-12');

                categorySection.innerHTML = `
                    <h2 class="text-3xl font-bold text-white mb-6">${category}</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 category-product-grid">
                    </div>
                `;
                allProductCategoriesContainer.appendChild(categorySection);

                const categoryGrid = categorySection.querySelector('.category-product-grid');
                const productsInCategory = products.filter(p => p.category === category);
                renderProductsIntoGrid(productsInCategory, categoryGrid);
            });
        }

        function handleSearch() {
            const searchTerm = mainSearchInput.value.toLowerCase();

            if (searchTerm.length > 0) {
                allProductCategoriesContainer.classList.add('hidden');
                recentlyViewedSection.classList.add('hidden');
                orderHistorySection.classList.add('hidden');
                searchResultsSection.classList.remove('hidden');

                const searchMatchedProducts = products.filter(product => {
                    return product.name.toLowerCase().includes(searchTerm) ||
                           product.description.toLowerCase().includes(searchTerm) ||
                           product.category.toLowerCase().includes(searchTerm);
                });
                renderProductsIntoGrid(searchMatchedProducts, searchResultsGrid);
            } else {
                searchResultsSection.classList.add('hidden');
                allProductCategoriesContainer.classList.remove('hidden');
                renderAllCategorizedProducts();
                renderRecentlyViewed();
                orderHistorySection.classList.remove('hidden');
            }
        }

        function attachProductCardEventListeners() {
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.onclick = null;
                button.addEventListener('click', (event) => {
                    const productCard = event.target.closest('.product-card');
                    const productId = productCard.dataset.id;
                    const product = products.find(p => p.id === productId);

                    const quantityInput = productCard.querySelector('.quantity-input');
                    let quantity = parseInt(quantityInput.value);

                    if (isNaN(quantity) || quantity <= 0) {
                        showMessage(`Please enter a valid quantity for ${product.name}.`);
                        return;
                    }

                    if (quantity > product.stock) {
                        showMessage(`Not enough stock for ${product.name}. Only ${product.stock} available. Adjusting quantity to max available.`);
                        quantity = product.stock;
                        quantityInput.value = product.stock;
                        if (quantity === 0) {
                            return;
                        }
                    }

                    product.stock -= quantity;

                    let currentStockElement = productCard.querySelector('.product-stock');
                    currentStockElement.textContent = `${product.stock} in stock`;
                    quantityInput.max = product.stock;

                    if (product.stock === 0) {
                        currentStockElement.classList.remove('text-lime-400');
                        currentStockElement.classList.add('text-rose-400');
                        quantityInput.value = 0;
                        quantityInput.disabled = true;
                        button.disabled = true;
                        button.textContent = 'Out of Stock';
                    } else if (quantityInput.value > product.stock) {
                        quantityInput.value = product.stock;
                    }

                    const existingItemIndex = cart.findIndex(item => item.id === productId);
                    if (existingItemIndex > -1) {
                        cart[existingItemIndex].quantity += quantity;
                    } else {
                        cart.push({ id: productId, name: product.name, price: product.price, quantity: quantity });
                    }

                    updateCartDisplay();
                    showMessage(`${quantity} x ${product.name} added to cart!`);
                });
            });

            document.querySelectorAll('.wishlist-toggle-btn').forEach(button => {
                button.onclick = null;
                button.addEventListener('click', (event) => {
                    const productId = event.currentTarget.dataset.id;
                    toggleWishlist(productId, event.currentTarget);
                });
            });

            document.querySelectorAll('.add-to-wishlist-btn').forEach(button => {
                button.onclick = null;
                button.addEventListener('click', (event) => {
                    const productId = event.currentTarget.dataset.id;
                    toggleWishlist(productId, event.currentTarget);
                });
            });

            document.querySelectorAll('.quick-view-btn').forEach(button => {
                button.onclick = null;
                button.addEventListener('click', (event) => {
                    const productId = event.currentTarget.dataset.id;
                    const product = products.find(p => p.id === productId);
                    if (product) {
                        addRecentlyViewed(productId);
                        currentProductForReview = product;

                        quickViewImage.src = product.imageUrl;
                        quickViewImage.onerror = () => { quickViewImage.src = 'https://placehold.co/400x250/333333/FFFFFF?text=Image+Error'; };
                        quickViewName.textContent = product.name;
                        quickViewCategory.textContent = product.category;
                        quickViewDescription.textContent = product.description;
                        quickViewRating.textContent = product.rating;
                        quickViewReviews.textContent = product.reviews;
                        quickViewPrice.textContent = usdToInr(product.price);
                        if (product.onSale) {
                            quickViewOriginalPrice.textContent = `₹${usdToInr(product.originalPrice)}`;
                        } else {
                            quickViewOriginalPrice.textContent = '';
                        }
                        quickViewStock.textContent = `${product.stock} in stock`;
                        quickViewStock.classList.toggle('text-rose-400', product.stock === 0);
                        quickViewStock.classList.toggle('text-lime-400', product.stock > 0);
                        quickViewQuantityInput.value = product.stock > 0 ? 1 : 0;
                        quickViewQuantityInput.max = product.stock;
                        quickViewQuantityInput.disabled = product.stock === 0;

                        quickViewAddToCartBtn.disabled = product.stock === 0;
                        quickViewAddToCartBtn.textContent = product.stock === 0 ? 'Out of Stock' : 'Add to Cart';
                        quickViewAddToCartBtn.onclick = () => {
                            const qty = parseInt(quickViewQuantityInput.value);
                            if (isNaN(qty) || qty <= 0 || qty > product.stock) {
                                showMessage(`Please enter a valid quantity for ${product.name}. Max available: ${product.stock}`);
                                return;
                            }
                            const existingItemIndex = cart.findIndex(item => item.id === productId);
                            if (existingItemIndex > -1) {
                                cart[existingItemIndex].quantity += qty;
                            } else {
                                cart.push({ id: productId, name: product.name, price: product.price, quantity: qty });
                            }
                            product.stock -= qty;
                            updateCartDisplay();
                            renderAllCategorizedProducts();
                            showMessage(`${qty} x ${product.name} added to cart!`);
                            closeModals();
                        };

                        const isProductInWishlistQuickView = wishlist.includes(product.id);
                        quickViewAddToWishlistBtn.innerHTML = `<i class="${isProductInWishlistQuickView ? 'fas' : 'far'} fa-heart mr-2"></i>${isProductInWishlistQuickView ? 'Remove from Wishlist' : 'Add to Wishlist'}`;
                        quickViewAddToWishlistBtn.onclick = () => {
                            toggleWishlist(product.id, quickViewAddToWishlistBtn);
                            const updatedIsProductInWishlist = wishlist.includes(product.id);
                            quickViewAddToWishlistBtn.innerHTML = `<i class="${updatedIsProductInWishlist ? 'fas' : 'far'} fa-heart mr-2"></i>${updatedIsProductInWishlist ? 'Remove from Wishlist' : 'Add to Wishlist'}`;
                        };

                        // Display existing reviews
                        quickViewExistingReviewsContainer.innerHTML = '<h4 class="text-lg font-semibold text-white mb-2">Customer Reviews:</h4>';
                        if (product.customerReviews && product.customerReviews.length > 0) {
                            product.customerReviews.forEach(review => {
                                const reviewDiv = document.createElement('div');
                                reviewDiv.classList.add('border-b', 'border-gray-700', 'py-2');
                                reviewDiv.innerHTML = `
                                    <p class="text-white font-semibold">${review.user} - <span class="text-amber-300">${review.rating} <i class="fas fa-star"></i></span></p>
                                    <p class="text-gray-400 text-sm">${review.comment}</p>
                                `;
                                quickViewExistingReviewsContainer.appendChild(reviewDiv);
                            });
                        } else {
                            quickViewExistingReviewsContainer.innerHTML += '<p class="text-gray-400">No reviews yet.</p>';
                        }

                        quickViewModal.style.display = 'flex';
                    }
                });
            });
        }

        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                const category = button.dataset.category;
                if (category === 'All') {
                    renderAllCategorizedProducts();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    const targetId = `category-${category.replace(/\s+/g, '-').toLowerCase()}`;
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }
                categoryDropdownContent.style.display = 'none';
                mainSearchInput.value = '';
                handleSearch();
            });
        });

        categoryDropdownButton.addEventListener('click', () => {
            categoryDropdownContent.style.display = categoryDropdownContent.style.display === 'block' ? 'none' : 'block';
        });

        sortDropdownButton.addEventListener('click', () => {
            sortDropdownContent.style.display = sortDropdownContent.style.display === 'block' ? 'none' : 'block';
        });

        sortButtons.forEach(button => {
            button.addEventListener('click', () => {
                currentSort = button.dataset.sort;
                sortDropdownContent.style.display = 'none';
                if (mainSearchInput.value.length > 0) {
                    handleSearch();
                } else {
                    renderAllCategorizedProducts();
                }
            });
        });

        mainSearchInput.addEventListener('input', handleSearch);

        applyPriceFilterBtn.addEventListener('click', () => {
            renderAllCategorizedProducts();
            if (mainSearchInput.value.length > 0) {
                handleSearch();
            }
        });

        clearPriceFilterBtn.addEventListener('click', () => {
            minPriceInput.value = '';
            maxPriceInput.value = '';
            currentMinPrice = null;
            currentMaxPrice = null;
            renderAllCategorizedProducts();
            if (mainSearchInput.value.length > 0) {
                handleSearch();
            }
        });

        applyRatingFilterBtn.addEventListener('click', () => {
            currentMinRating = parseFloat(minRatingSelect.value);
            renderAllCategorizedProducts();
            if (mainSearchInput.value.length > 0) {
                handleSearch();
            }
        });

        clearRatingFilterBtn.addEventListener('click', () => {
            minRatingSelect.value = '0';
            currentMinRating = 0;
            renderAllCategorizedProducts();
            if (mainSearchInput.value.length > 0) {
                handleSearch();
            }
        });

        wishlistButton.addEventListener('click', () => {
            wishlistModal.style.display = 'flex';
            updateWishlistDisplay();
        });

        clearWishlistBtn.addEventListener('click', () => {
            wishlist.forEach(productId => {
                const productCardElement = document.querySelector(`.product-card[data-id="${productId}"]`);
                if (productCardElement) {
                    const heartIcon = productCardElement.querySelector('.wishlist-toggle-btn i');
                    heartIcon.classList.remove('fas', 'text-rose-500');
                    heartIcon.classList.add('far', 'text-gray-400');
                    const addToWishlistBtn = productCardElement.querySelector('.add-to-wishlist-btn');
                    if (addToWishlistBtn) {
                        addToWishlistBtn.innerHTML = `<i class="far fa-heart mr-2"></i>Add to Wishlist`;
                    }
                }
            });
            wishlist = [];
            updateWishlistDisplay();
            showMessage("Wishlist cleared!");
        });

        clearCartBtn.addEventListener('click', () => {
            cart.forEach(item => {
                const product = products.find(p => p.id === item.id);
                if (product) {
                    product.stock += item.quantity;
                }
            });
            cart = [];
            updateCartDisplay();
            renderAllCategorizedProducts();
            showMessage("Cart cleared!");
        });

        addToCartFromWishlistBtn.addEventListener('click', () => {
            if (wishlist.length === 0) {
                showMessage("Your wishlist is empty!");
                return;
            }

            let addedCount = 0;
            let notAddedCount = 0;
            let notAddedNames = [];

            const wishlistCopy = [...wishlist]; 

            wishlistCopy.forEach(productId => {
                const product = products.find(p => p.id === productId);
                if (product && product.stock > 0) {
                    const existingCartItem = cart.find(item => item.id === productId);
                    if (existingCartItem) {
                        if (existingCartItem.quantity < product.stock) {
                            existingItem.quantity++;
                            product.stock--;
                            addedCount++;
                        } else {
                            notAddedCount++;
                            notAddedNames.push(product.name);
                        }
                    } else {
                        cart.push({ id: productId, name: product.name, price: product.price, quantity: 1 });
                        product.stock--;
                        addedCount++;
                    }
                    wishlist = wishlist.filter(id => id !== productId);
                } else {
                    notAddedCount++;
                    if (product) notAddedNames.push(product.name);
                }
            });

            updateCartDisplay();
            updateWishlistDisplay();
            renderAllCategorizedProducts();

            let message = "";
            if (addedCount > 0) {
                message += `${addedCount} item(s) moved from wishlist to cart.`;
            }
            if (notAddedCount > 0) {
                if (message.length > 0) message += "\n";
                message += `${notAddedCount} item(s) could not be added (out of stock or already maxed out in cart): ${notAddedNames.join(', ')}.`;
            }
            if (addedCount === 0 && notAddedCount === 0) {
                message = "No items to add from wishlist.";
            }
            showMessage(message);
        });

        quickViewAddReviewBtn.addEventListener('click', () => {
            if (currentProductForReview) {
                reviewProductName.textContent = `Reviewing: ${currentProductForReview.name}`;
                reviewRatingInput.value = 0;
                reviewTextInput.value = '';
                updateStarRatingDisplay(0);
                reviewModal.style.display = 'flex';
            }
        });

        starRatingContainer.addEventListener('click', (event) => {
            const star = event.target.closest('.fa-star');
            if (star) {
                const rating = parseInt(star.dataset.rating);
                reviewRatingInput.value = rating;
                updateStarRatingDisplay(rating);
            }
        });

        function updateStarRatingDisplay(selectedRating) {
            starRatingContainer.querySelectorAll('.fa-star').forEach(star => {
                const rating = parseInt(star.dataset.rating);
                if (rating <= selectedRating) {
                    star.classList.remove('far');
                    star.classList.add('fas', 'selected');
                } else {
                    star.classList.remove('fas', 'selected');
                    star.classList.add('far');
                }
            });
        }

        submitReviewBtn.addEventListener('click', () => {
            const rating = parseInt(reviewRatingInput.value);
            const reviewText = reviewTextInput.value.trim();

            if (rating === 0) {
                showMessage("Please select a star rating.");
                return;
            }
            if (reviewText.length < 10) {
                showMessage("Please write a more detailed review (minimum 10 characters).");
                return;
            }

            if (currentProductForReview) {
                const oldTotalRating = currentProductForReview.rating * currentProductForReview.reviews;
                currentProductForReview.reviews++;
                currentProductForReview.rating = (oldTotalRating + rating) / currentProductForReview.reviews;
                currentProductForReview.rating = parseFloat(currentProductForReview.rating.toFixed(1));

                if (!currentProductForReview.customerReviews) {
                    currentProductForReview.customerReviews = [];
                }
                currentProductForReview.customerReviews.push({ user: 'You', rating: rating, comment: reviewText });

                showMessage(`Thank you for your review of ${currentProductForReview.name}!`);
                closeModals();
                renderAllCategorizedProducts();
                renderRecentlyViewed();
            }
        });

        renderAllCategorizedProducts();
        renderRecentlyViewed();

        cartButton.addEventListener('click', () => {
            cartModal.style.display = 'flex';
            updateCartDisplay();
        });

        updateCartDisplay();
        updateWishlistDisplay();

        window.addEventListener('DOMContentLoaded', () => {
            showMessage("Welcome to TechMart! Happy Shopping!");
        });
    </script>
</body>
</html>
